<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#F2F0E9" id="theme-color-meta" />
    <meta
      name="description"
      content="Claudeå’ŒGeminièŠå¤©è®°å½•ç®¡ç†å·¥å…· - æ•´ç†ã€æœç´¢å’Œå¯¼å‡ºå¯¹è¯æ•°æ®"
    />
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo1024.png" />
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    
    <!-- PWA ç›¸å…³metaæ ‡ç­¾ -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Lyra Exporter">
    
    <title>ClaudeèŠå¤©è®°å½•ç®¡ç† | Lyra's Exporter</title>
    <meta name="author" content="Lyra (Yalums)" />
    <meta name="copyright" content="Â© 2025 Lyra's Exporter. All Rights Reserved." />
    
    <!-- åŠ¨æ€ä¸»é¢˜è‰²è®¾ç½® -->
    <script>
      // è®¾ç½®åŠ¨æ€ä¸»é¢˜è‰²
      function updateThemeColor() {
        // æ£€æŸ¥ç³»ç»Ÿä¸»é¢˜åå¥½å’Œæ‰‹åŠ¨è®¾ç½®
        const htmlElement = document.documentElement;
        const manualTheme = htmlElement.getAttribute('data-theme');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        
        // å†³å®šå½“å‰ä¸»é¢˜ï¼šæ‰‹åŠ¨è®¾ç½®ä¼˜å…ˆï¼Œå¦åˆ™è·Ÿéšç³»ç»Ÿ
        const isDark = manualTheme ? manualTheme === 'dark' : prefersDark;
        
        const themeColorMeta = document.getElementById('theme-color-meta');
        const newColor = isDark ? '#262624' : '#F2F0E9';
        
        if (themeColorMeta) {
          themeColorMeta.setAttribute('content', newColor);
        }
        
        // åŒæ—¶è®¾ç½®CSSå˜é‡ï¼Œç¡®ä¿PWAå¯åŠ¨æ—¶èƒŒæ™¯æ­£ç¡®
        document.documentElement.style.setProperty('--pwa-bg-color', newColor);
        
        console.log('ä¸»é¢˜è‰²å·²æ›´æ–°ä¸º:', newColor, 'ï¼ˆæ˜¯å¦æ·±è‰²:', isDark, 'ï¼‰');
      }
      
      // ç«‹å³æ‰§è¡Œä¸€æ¬¡
      updateThemeColor();
      
      // ç›‘å¬ç³»ç»Ÿä¸»é¢˜å˜åŒ–
      window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', updateThemeColor);
      
      // ç›‘å¬æ‰‹åŠ¨ä¸»é¢˜åˆ‡æ¢ï¼ˆå¦‚æœåº”ç”¨æœ‰ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½ï¼‰
      const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
          if (mutation.type === 'attributes' && mutation.attributeName === 'data-theme') {
            updateThemeColor();
          }
        });
      });
      
      observer.observe(document.documentElement, {
        attributes: true,
        attributeFilter: ['data-theme']
      });
      
      // å…¨å±€æš´éœ²å‡½æ•°ï¼Œä¾›åº”ç”¨è°ƒç”¨
      window.updatePWAThemeColor = updateThemeColor;
    </script>
    
    <!-- æ·»åŠ å¯åŠ¨ç”»é¢èƒŒæ™¯è‰²CSS -->
    <style>
      html {
        background-color: var(--pwa-bg-color, #F2F0E9);
      }
      
      @media (prefers-color-scheme: dark) {
        html {
          background-color: #262624;
        }
      }
    </style>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
    
    <!-- Service Worker æ³¨å†Œ -->
    <script>
// Service Worker æ³¨å†Œ - ä»…åœ¨ç”Ÿäº§ç¯å¢ƒ
if ('serviceWorker' in navigator && window.location.hostname !== 'localhost' && !window.location.hostname.startsWith('127.')) {
  window.addEventListener('load', () => {
    const swUrl = `${process.env.PUBLIC_URL || ''}/sw.js`;
    
    navigator.serviceWorker.register(swUrl)
      .then(registration => {
        console.log('SWæ³¨å†ŒæˆåŠŸ:', registration);
        
        // æ£€æŸ¥æ›´æ–°
        registration.addEventListener('updatefound', () => {
          const newWorker = registration.installing;
          console.log('å‘ç°æ–°ç‰ˆæœ¬ Service Worker');
          
          newWorker.addEventListener('statechange', () => {
            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
              console.log('æ–°ç‰ˆæœ¬å·²å‡†å¤‡å°±ç»ª');
              newWorker.postMessage({ type: 'SKIP_WAITING' });
              
              navigator.serviceWorker.addEventListener('controllerchange', () => {
                window.location.reload();
              });
            }
          });
        });
        
        // å®šæœŸæ£€æŸ¥æ›´æ–°
        setInterval(() => {
          registration.update();
        }, 30000);
      })
      .catch(error => {
        console.log('SWæ³¨å†Œå¤±è´¥ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰:', error);
      });
  });
} else {
  console.log('å¼€å‘ç¯å¢ƒ - Service Worker å·²ç¦ç”¨');
}
    </script>

    <!-- ç‰ˆæœ¬æ›´æ–°å…¬å‘Š -->
    <div id="version-announcement" style="display: none;">
      <div style="
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 9999;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
        box-sizing: border-box;
      ">
        <div style="
          background: white;
          border-radius: 12px;
          padding: 24px;
          max-width: 500px;
          width: 100%;
          box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
          animation: slideIn 0.3s ease-out;
        ">
          <h2 style="
            margin: 0 0 16px 0;
            color: #333;
            font-size: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
          ">
            <span style="font-size: 24px;">ğŸ‰</span>
            ç‰ˆæœ¬æ›´æ–° - æ–°åŠŸèƒ½ä¸Šçº¿
          </h2>

          <div style="
            color: #666;
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 20px;
          ">
            <p style="margin: 0 0 12px 0; font-weight: 500; color: #444;">æœ¬æ¬¡æ›´æ–°å¸¦æ¥ä»¥ä¸‹æ–°åŠŸèƒ½ï¼š</p>
            <ul style="margin: 0; padding-left: 20px;">
              <li style="margin-bottom: 8px;">
                <strong>æ”¯æŒ Gemini å¤šåˆ†æ”¯è§£æ</strong><br/>
                <span style="color: #888; font-size: 13px;">æ‰“å¼€é…å¥—è„šæœ¬çš„ã€Œå®æ—¶ã€é€‰é¡¹å³å¯ä½¿ç”¨</span>
              </li>
              <li style="margin-bottom: 8px;">
                <strong>æ‰¹é‡å¯¼å‡ºæœ€æ–°åˆ†æ”¯åŠŸèƒ½</strong><br/>
                <span style="color: #888; font-size: 13px;">åŸæ¥çš„ claude_all_conversation ç°åœ¨å¯ä»¥å¯¼å‡ºåˆ°ä¸€ä¸ªå‹ç¼©åŒ…å†…</span>
              </li>
              <li style="margin-bottom: 8px;">
                <strong>ä¸€é”®è·³è½¬åˆ°æœ€æ–°åˆ†æ”¯</strong><br/>
                <span style="color: #888; font-size: 13px;">å¿«é€ŸæŸ¥çœ‹å¯¹è¯çš„æœ€æ–°å†…å®¹</span>
              </li>
              <li style="margin-bottom: 0;">
                <strong>æ‰¹é‡å¯¼å‡ºå¯¹è¯çš„æœ€æ–°åˆ†æ”¯</strong><br/>
                <span style="color: #888; font-size: 13px;">æ›´ä¾¿æ·çš„æ‰¹é‡å¯¼å‡ºä½“éªŒ</span>
              </li>
            </ul>
          </div>

          <button onclick="closeAnnouncement()" style="
            width: 100%;
            padding: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: transform 0.2s;
          " onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'">
            æˆ‘çŸ¥é“äº†
          </button>
        </div>
      </div>
    </div>

    <style>
      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateY(-20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @media (prefers-color-scheme: dark) {
        #version-announcement > div > div {
          background: #2a2a2a !important;
        }
        #version-announcement h2 {
          color: #e0e0e0 !important;
        }
        #version-announcement p,
        #version-announcement strong {
          color: #d0d0d0 !important;
        }
        #version-announcement li span {
          color: #999 !important;
        }
      }
    </style>

    <script>
      // ç‰ˆæœ¬å…¬å‘Šç®¡ç†
      const ANNOUNCEMENT_VERSION = 'v1.0.0'; // æ›´æ–°ç‰ˆæœ¬å·ä¼šé‡æ–°æ˜¾ç¤ºå…¬å‘Š
      const STORAGE_KEY = 'announcement_seen_' + ANNOUNCEMENT_VERSION;

      function closeAnnouncement() {
        const announcement = document.getElementById('version-announcement');
        if (announcement) {
          announcement.style.display = 'none';
          localStorage.setItem(STORAGE_KEY, 'true');
        }
      }

      // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥æ˜¯å¦éœ€è¦æ˜¾ç¤ºå…¬å‘Š
      window.addEventListener('load', function() {
        const hasSeenAnnouncement = localStorage.getItem(STORAGE_KEY);
        if (!hasSeenAnnouncement) {
          const announcement = document.getElementById('version-announcement');
          if (announcement) {
            // å»¶è¿Ÿ500msæ˜¾ç¤ºï¼Œè®©é¡µé¢å…ˆåŠ è½½
            setTimeout(function() {
              announcement.style.display = 'block';
            }, 500);
          }
        }
      });
    </script>
  </body>
</html>
